<html lang="zh"> <head> <meta charset="utf-8"/> <link rel="shortcut icon" href="https://www.mdeditor.com/images/logos/favicon.ico" type="image/x-icon"/> </head> <body><h2 id="h2-bitmoneytree-luamodule-api"><a name="BitMoneyTree—LuaModule API" class="reference-link"></a><span class="header-link octicon octicon-link"></span>BitMoneyTree—LuaModule API</h2><p><em>用其他语言阅读：<a href="https://github.com/BitMoneyTree/BitMoneyTree/blob/master/LuaModule%20API_en.md" title="English">English</a>,<a href="https://github.com/BitMoneyTree/BitMoneyTree/blob/master/LuaModule%20API_hk.md" title="繁體中文">繁體中文</a>,<a href="https://github.com/BitMoneyTree/BitMoneyTree/blob/master/LuaModule%20API_cn.md" title="简体中文">简体中文</a></em></p> <h3 id="h3-luadb-"><a name="LuaDB模块" class="reference-link"></a><span class="header-link octicon octicon-link"></span>LuaDB模块</h3><p>创建数据库对象例如：<code>db=dbhelper（数据库名）</code></p> <h4 id="h4-db-openquery-str-"><a name="db:openQuery(str)" class="reference-link"></a><span class="header-link octicon octicon-link"></span>db:openQuery(str)</h4><p>执行SQL语句并返回执行后的结果,基本用于查询语句<br>参数: </p><table> <thead> <tr> <th>字段名称</th> <th>描述</th> <th>数据类型</th> </tr> </thead> <tbody> <tr> <td>str</td> <td>SQL语句</td> <td>string</td> </tr> </tbody> </table> <p>响应table数据：<br><code>{ [1]={ XDJL06="14.2089", XDJL04="2106261898", XDJL15="15.2089", XDJL14="1597991460", XDJL02="Binance", XDJL03="linkusdt", XDJL12="210626", XDJL07="1", XDJL01=1898, XDJL11="Traded", XDJL10="2020/8/21 星期五 18:00:29", XDJL09="TestData", XDJL08="DoubleKLineBOLL", XDJL05="sell"}, [2]={ XDJL06="16.0563", XDJL04="2106261899", XDJL15="15.0563", XDJL14="1597992120", XDJL02="Binance", XDJL03="linkusdt", XDJL12="210626", XDJL07="1", XDJL01=1899, XDJL11="Traded", XDJL10="2020/8/21 星期五 18:00:31", XDJL09="TestData", XDJL08="DoubleKLineBOLL", XDJL05="buy"}, CRC32=-1511945275, fields={ [1]={ field_type=3, field_size=4, field_name="XDJL01"}, [2]={ field_type=202, field_size=7, field_name="XDJL02"}, [3]={ field_type=202, field_size=8, field_name="XDJL03"}, [4]={ field_type=202, field_size=14, field_name="XDJL04"}, [5]={ field_type=202, field_size=4, field_name="XDJL05"}, [6]={ field_type=202, field_size=8, field_name="XDJL06"}, [7]={ field_type=202, field_size=6, field_name="XDJL07"}, [8]={ field_type=202, field_size=15, field_name="XDJL08"}, [9]={ field_type=202, field_size=8, field_name="XDJL09"}, [10]={ field_type=135, field_size=25, field_name="XDJL10"}, [11]={ field_type=202, field_size=11, field_name="XDJL11"}, [12]={ field_type=202, field_size=10, field_name="XDJL12"}, [13]={ field_type=202, field_size=117, field_name="XDJL13"}, [14]={ field_type=202, field_size=10, field_name="XDJL14"}, [15]={ field_type=202, field_size=8, field_name="XDJL15"}, field_count=15}}</code></p> <h4 id="h4-db-executenoquery-str-"><a name="db:executeNoQuery(str)" class="reference-link"></a><span class="header-link octicon octicon-link"></span>db:executeNoQuery(str)</h4><p>执行SQL语句不返回数据，一般用于删除语句<br>参数: </p><table> <thead> <tr> <th>字段名称</th> <th>描述</th> <th>数据类型</th> </tr> </thead> <tbody> <tr> <td>str</td> <td>SQL语句</td> <td>string</td> </tr> </tbody> </table> <p>无响应数据</p> <h4 id="h4-db-insert-tablename-databasetablename-"><a name="db:insert(tableName,DatabaseTableName)" class="reference-link"></a><span class="header-link octicon octicon-link"></span>db:insert(tableName,DatabaseTableName)</h4><p>向数据库里的某个表插入数据，首先创建一个table，把需要插入的数据放入table里，例如：table.表字段名 = 需要插入的数据<br>参数： </p><table> <thead> <tr> <th>字段名称</th> <th>描述</th> <th>数据类型</th> </tr> </thead> <tbody> <tr> <td>tableName</td> <td>创建的table名</td> <td>string</td> </tr> <tr> <td>DatabaseTableName</td> <td>数据库表名</td> <td>string</td> </tr> </tbody> </table> <p>无响应数据</p> <h4 id="h4-db-update-tablename-databasetablename-condition-"><a name="db:update(tableName,DatabaseTableName,condition)" class="reference-link"></a><span class="header-link octicon octicon-link"></span>db:update(tableName,DatabaseTableName,condition)</h4><p>修改数据库里某个表的数据，首先创建一个table，把需要修改的字段放入table里，例如：table.表字段名 = 需要修改的数据<br>参数： </p><table> <thead> <tr> <th>字段名称</th> <th>描述</th> <th>数据类型</th> </tr> </thead> <tbody> <tr> <td>tableName</td> <td>创建的table名</td> <td>string</td> </tr> <tr> <td>DatabaseTableName</td> <td>数据库表名</td> <td>string</td> </tr> <tr> <td>condition</td> <td>修改条件</td> <td>string</td> </tr> </tbody> </table> <p>无响应数据</p> <h3 id="h3-memtable-"><a name="MemTable模块" class="reference-link"></a><span class="header-link octicon octicon-link"></span>MemTable模块</h3><h4 id="h4-memtable-type-tablename-"><a name="Memtable(type,tableName)" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Memtable(type,tableName)</h4><p>创建一个Memtable对象例如:<code>tb=Memtable("BuyDept","Huobi_xrpusdt_1min")</code><br>参数： </p><table> <thead> <tr> <th>字段名称</th> <th>描述</th> <th>数据类型</th> </tr> </thead> <tbody> <tr> <td>type</td> <td>表类型（买盘深度卖盘深度：BuyDept、SellDept；买一卖一逐笔行情：BuySellOne;K线：KLine；汇率：ExchangeRate）</td> <td>string</td> </tr> <tr> <td>tableName</td> <td>要创建的表名</td> <td>string</td> </tr> </tbody> </table> <p>无响应数据</p> <h4 id="h4-tb-add-"><a name="tb:add()" class="reference-link"></a><span class="header-link octicon octicon-link"></span>tb:add()</h4><p>对Memtable表插入数据<br>例如：<code>tb:add(price,amount,timestamp)</code><br>不同表类型参数不同：<br>BuyDept、SellDept: </p><table> <thead> <tr> <th>字段名称</th> <th>描述</th> <th>数据类型</th> </tr> </thead> <tbody> <tr> <td>参数1</td> <td>价格</td> <td>number</td> </tr> <tr> <td>参数2</td> <td>数量</td> <td>number</td> </tr> <tr> <td>参数3</td> <td>时间戳（秒）</td> <td>number</td> </tr> </tbody> </table> <p>BuySellOne:</p> <table> <thead> <tr> <th>字段名称</th> <th>描述</th> <th>数据类型</th> </tr> </thead> <tbody> <tr> <td>参数1</td> <td>买一价</td> <td>number</td> </tr> <tr> <td>参数2</td> <td>买一量</td> <td>number</td> </tr> <tr> <td>参数3</td> <td>卖一价</td> <td>number</td> </tr> <tr> <td>参数4</td> <td>卖一量</td> <td>number</td> </tr> <tr> <td>参数5</td> <td>时间戳（秒）</td> <td>number</td> </tr> </tbody> </table> <p>KLine：</p> <table> <thead> <tr> <th>字段名称</th> <th>描述</th> <th>数据类型</th> </tr> </thead> <tbody> <tr> <td>参数1</td> <td>开盘价</td> <td>number</td> </tr> <tr> <td>参数2</td> <td>收盘价</td> <td>number</td> </tr> <tr> <td>参数3</td> <td>最高价</td> <td>number</td> </tr> <tr> <td>参数4</td> <td>最低价</td> <td>number</td> </tr> <tr> <td>参数5</td> <td>交易量</td> <td>number</td> </tr> <tr> <td>参数6</td> <td>时间戳（秒）</td> <td>number</td> </tr> </tbody> </table> <p>ExchangeRate：</p> <table> <thead> <tr> <th>字段名称</th> <th>描述</th> <th>数据类型</th> </tr> </thead> <tbody> <tr> <td>参数1</td> <td>交易对</td> <td>number</td> </tr> <tr> <td>参数2</td> <td>价格</td> <td>number</td> </tr> <tr> <td>参数3</td> <td>时间戳（秒）</td> <td>number</td> </tr> </tbody> </table> <p>无响应参数</p> <h4 id="h4-tb-query-"><a name="tb:query()" class="reference-link"></a><span class="header-link octicon octicon-link"></span>tb:query()</h4><p>查询Memtable表数据<br>参数：无<br>响应table数据：<br><code>{ [1]={ sellsize=168.02, buysize=439.81, sell=0.26956, ts=1599114991, buy=0.26948}, fields={ [1]={ field_type=5, field_size=20, field_name="buy"}, [2]={ field_type=5, field_size=20, field_name="buysize"}, [3]={ field_type=5, field_size=20, field_name="sell"}, [4]={ field_type=5, field_size=20, field_name="sellsize"}, [5]={ field_type=5, field_size=20, field_name="ts"}, field_count=5}}</code></p> <h4 id="h4-tb-clear-"><a name="tb:clear()" class="reference-link"></a><span class="header-link octicon octicon-link"></span>tb:clear()</h4><p>清除Memtable表数据<br>参数:无<br>无响应数据 </p><h3 id="h3-inet-"><a name="inet模块" class="reference-link"></a><span class="header-link octicon octicon-link"></span>inet模块</h3><h4 id="h4-inet-requesturl-url-"><a name="inet.requestUrl(url)" class="reference-link"></a><span class="header-link octicon octicon-link"></span>inet.requestUrl(url)</h4><p>请求链接<br>参数： </p><table> <thead> <tr> <th>字段名称</th> <th>描述</th> <th>数据类型</th> </tr> </thead> <tbody> <tr> <td>url</td> <td>链接地址</td> <td>string</td> </tr> </tbody> </table> <p>响应json数据：<br><code>{"resultCode":"ok","data":{"serverTime":"1599116231440"}}</code></p> <h4 id="h4-inet-hash_hmac-parameter-1-parameter-2-parameter-3-"><a name="inet.hash_hmac(Parameter 1,Parameter 2,Parameter 3);" class="reference-link"></a><span class="header-link octicon octicon-link"></span>inet.hash_hmac(Parameter 1,Parameter 2,Parameter 3);</h4><p>根据秘钥和加密方式进行加密<br>参数： </p><table> <thead> <tr> <th>字段名称</th> <th>描述</th> <th>数据类型</th> </tr> </thead> <tbody> <tr> <td>Parameter 1</td> <td>加密方式（sha256；md5；sha512等等）</td> <td>string</td> </tr> <tr> <td>Parameter 2</td> <td>需要进行加密的字符串</td> <td>string</td> </tr> <tr> <td>Parameter 3</td> <td>秘钥</td> <td>string</td> </tr> </tbody> </table> <h4 id="h4-inet-timestamp-"><a name="inet.timestamp()" class="reference-link"></a><span class="header-link octicon octicon-link"></span>inet.timestamp()</h4><p>获取时间戳<br>参数：无<br>响应number数据：<br><code>1599117673.123</code></p> <h4 id="h4-inet-utf8toansi-parameter-1-"><a name="inet.utf8toansi(Parameter 1)" class="reference-link"></a><span class="header-link octicon octicon-link"></span>inet.utf8toansi(Parameter 1)</h4><p>把utf8编码数据转换成ansi编码</p> <table> <thead> <tr> <th>字段名称</th> <th>描述</th> </tr> </thead> <tbody> <tr> <td>Parameter 1</td> <td>需要转换的数据</td> </tr> </tbody> </table> </body> </html>
